<?xml version="1.0" encoding="utf-8"?>

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:controls="clr-namespace:TriloBot.Maui.Controls"
             xmlns:ios="clr-namespace:Microsoft.Maui.Controls.PlatformConfiguration.iOSSpecific;assembly=Microsoft.Maui.Controls"
             x:Class="TriloBot.Maui.Pages.JoystickPage"
             Shell.NavBarIsVisible="False"
             ios:Page.UseSafeArea="False">
    <Grid
        HorizontalOptions="Fill"
        VerticalOptions="Fill"
        Padding="0"
        IgnoreSafeArea="True">
        <!-- WebView for the camera stream -->
        <WebView Source="http://pi5:8889/cam"
                 Background="Black"
                 HorizontalOptions="Fill"
                 VerticalOptions="Fill"
                 Margin="0"/>

        <!-- Overlay controls -->
        <Grid x:Name="ControlGrid"
              VerticalOptions="End"
              HorizontalOptions="Fill"
              Padding="0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Joystick Control on the left -->
            <controls:JoystickControl x:Name="Joystick"
                                      Grid.Column="0"/>

            <!-- Status and Navigation -->
            <StackLayout Grid.Column="1"
                         Orientation="Horizontal"
                         HorizontalOptions="Center"
                         VerticalOptions="End"
                         Spacing="12"
                         Padding="12,20">

                <Label x:Name="IsConnectedLabel"
                       Text="Disconnected"
                       HorizontalTextAlignment="Center"/>

                <Label x:Name="DistanceLabel"
                       Text="Distance: 0"
                       HorizontalTextAlignment="Center"/>
                       
                <!-- Remote Control Navigation Button -->
                <Border Style="{StaticResource NavigationButtonBorderStyle}"
                        HeightRequest="40"
                        WidthRequest="40"
                        Padding="6">
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnNavigateToMainTapped" />
                    </Border.GestureRecognizers>
                    <Image Source="remote_white.png"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           WidthRequest="20"
                           HeightRequest="20"/>
                </Border>
            </StackLayout>

            <!-- Circular Buttons on the right -->
            <Grid
                Grid.Column="2"
                ColumnSpacing="4"
                RowSpacing="4"
                VerticalOptions="Center"
                HorizontalOptions="Center">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Buttons in a circular layout -->
                <Border
                    Grid.Row="0"
                    Grid.Column="0"
                    Style="{StaticResource TopLeftRoundedBorderStyle}">
                    <ImageButton
                        Source="cd_on.png"
                        Clicked="AutoModeButton_OnClicked"/>
                </Border>

                <Border
                    Grid.Row="0"
                    Grid.Column="1"
                    Style="{StaticResource TopRightRoundedBorderStyle}">
                    <ImageButton
                        Source="horn_on.png"
                        Clicked="LightSpecialButton_OnClicked"/>
                </Border>

                <Border
                    Grid.Row="1"
                    Grid.Column="0"
                    Style="{StaticResource BottomLeftRoundedBorderStyle}">
                    <ImageButton
                        Source="light_on.png"
                        Clicked="LightOnButton_OnClicked"/>
                </Border>

                <Border
                    Grid.Row="1"
                    Grid.Column="1"
                    Style="{StaticResource BottomRightRoundedBorderStyle}">
                    <ImageButton
                        Source="light_mode_2_off.png"
                        Clicked="LightOffButton_OnClicked"/>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</ContentPage>